<!DOCTYPE html>
<html>
<head>
    <title>Live Stream</title>
</head>
<body>
    <h2>Live Stream</h2>
    <div>
        <img id="live-stream" src="" alt="Loading Stream..." style="width: 800px; height: 450px;">
    </div>

    <script>
        const wsUrl = "ws://localhost:8000/ws/video/"; // שים את הכתובת המקומית שלך
        const imageElement = document.getElementById("live-stream");

        const socket = new WebSocket(wsUrl);

        socket.onopen = () => {
            console.log("WebSocket connected.");
        };

        socket.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                if (data.frame) {
                    imageElement.src = "data:image/jpeg;base64," + data.frame;
                }
            } catch (e) {
                console.error("Error parsing frame:", e);
            }
        };

        socket.onerror = (error) => {
            console.error("WebSocket Error:", error);
        };

        socket.onclose = () => {
            console.log("WebSocket disconnected.");
            setTimeout(() => {
                location.reload(); // ניסיון התחברות מחדש
            }, 5000);
        };
    </script>
</body>
</html>
